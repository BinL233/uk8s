## 网络插件 升级

UK8S 提供的 CNI （Container Network Interface）基于 UCloud VPC 网络实现，因此会随着 VPC 的功能迭代同步更新版本，以提升容器网络的稳定性及性能。
UK8S提供 CNI 在线升级的功能，插件升级不会影响现有 Pod 的网络。CNI 升级成功后：

1. 其实现的网络特性将作用于新申请的 Pod；
2. 老的 Pod 如果也需要获得对应的网络特性，则需要滚动升级以触发 Pod 重建; 

下面将介绍下如何在线升级网络插件。

### 1、网络插件更新纪要

|版本|类型|更新说明|发布时间|
|----|----|--------|--------|
|21.01.3|Bugfix|兼容开启了弹性网卡的UHost节点，解决其无法出外网的问题|2021年1月29日|
|21.01.2|Feature|将 Pod 的默认 MTU 设置为1452|2021年1月15日|

文档更新可能滞后，最新版本请以产品页面为准。

### 2、网络插件升级

#### 2.1 进入网络插件升级页面

1. 登录 UCloud 控制台，进入 [UK8S 列表 页面](https://console.ucloud.cn/uk8s/manage)；

2. 选择需要升级网络插件的 UK8S 集群，点击“详情” 按钮，进入集群详情页；

3. 点击“插件”-->"网络插件"按钮，即进入网络插件升级页面；

#### 2.2 开启网络插件升级组件

UK8S 提供的网络插件在线升级功能，依赖一个DaemonSet来完成，所以我们要升级网络插件，需要先在集群安装一个“网络插件升级服务”。

1. 点击“立即开启”按钮，查看弹窗提示并点击“确认”按钮，即开始升级服务的安装流程；

2. 等待片刻，如果超过三分钟依然没有安装成功，请联系UCloud 技术支持；

3. “网络插件服务”安装成功后，我们可以看到当前支持的最新 CNI 版本，以及所有 Node 节点的当前 CNI 版本;

4. 如果当前版本小于最新版本，则可以进行在线升级；

#### 2.3 升级网络插件

支持单节点和批量升级，建议先升级单台节点，如果升级成功，则再进行批量升级。

>> 备注：网络插件升级集群，请勿进行服务发布等操作

1. 选择某个节点（条件允许可选择没有 Pod 运行的节点），点击升级；

2. 节点状态变为“升级中”，这个状态一般会持续1~3分钟，如果超过3分钟未升级成功，请联系 UCloud 技术支持；

3. 如果升级失败，则可以再尝试“强制升级”；

4. 插件升级成功后，节点状态变为“正常”，由于当前版本等于最新版本，则“升级按钮”置灰无法操作；

5. 单节点升级成功后，则可以进行“批量升级”；

6. 部分节点由于版本原因，可能无法获取到“当前CNI版本”，直接点击强制升级即可；

#### 2.4 关闭网络插件升级服务

当所有节点都升级成功后，我们可以关闭“网络插件升级服务”，以避免浪费集群资源；

1. 点击右上角的“关闭网络插件”，并在弹窗点击确认即可；

2. 网络插件关闭后，将不再消耗集群资源，后续你可以查看该文档以决定是否要再次升级；
