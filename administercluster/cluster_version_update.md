# 集群版本升级

本文主要介绍如何在UK8S集群中，使用版本升级功能。

> 大版本升级暂时仅支持大于等于1.14版本的UK8S集群

## 注意事项

1. 升级之前请务必关闭集群中的伸缩组插件！
2. 目前版本升级支持大版本升级和小版本升级。
3. 由于大版本之间API及组件变化较大，现大版本升级支持集群大于等于1.14版本进行使用。
4. 小版本升级支持升级至UK8S维护的最新小版本，具体可以点击版本升级进行查询。
5. 版本升级会导致集群内容器重启，导致重启会有以下几种情况。
   1. 1.14版本集群进行大版本升级，升级至1.15、1.16、1.17、1.18
   2. 1.15版本集群进行大版本升级，升级至1.16、1.17、1.18
   3. 单节点升级时间过长（kubernetes中节点NotReady持续5分钟后，Pod将会飘到其他Ready节点上）

![](/images/administercluster/cluster_update2.png)

## 升级操作

> 请在集群升级之前，在集群中所有节点创建拥有Root权限的账号且保证密码一致，关闭集群中的集群伸缩插件。

我们在集群列表页面，点击操作【更多】按键可以看到【版本升级】。我们可以看到集群升级的目标版本和ssh账号密码。

![](/images/administercluster/list_update2.png)

进入集群升级操作后，请耐心等待，不要对集群节点进行操作，确保升级顺利完成。

![](/images/administercluster/cluster_update3.png)

升级集群耗时根据节点不同时间也有所不同，例如10台节点的集群约耗时10分钟。升级过程您可以关闭该页面，并随时可以再次进入【版本升级】查看升级进度。

> 强制升级将会忽略K8S集群预检查，直接进行升级，仍需要输入正确的Root账号密码。

## 升级失败

如遇升级失败，可以在集群列表页面点击操作【更多】按键可以看到【版本升级】下载升级日志，如是您在升级期间对集群有操作导致的失败您可以根据日志提示修改后，重新进行升级操作。

如您对于日志所述内容无法进行判断，请您与我们技术支持联系，对集群进行诊断后重新进行升级。

## 常见升级失败原因

* 集群节点处于关闭或kubelet运行状态不正常
* 集群节点无法正常SSH，密码错误等
* 集群节点可以SSH，但无Root权限
* 集群伸缩插件没有关闭，导致新加入集群的节点无权限操作